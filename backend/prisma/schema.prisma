// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AbsenceType {
  sick_leave
  day_off
  vacation
  work_from_home
}

enum AbsenceStatus {
  pending
  approved
  rejected
}

model Position {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users User[]

  @@map("positions")
}

model User {
  id           String    @id @default(uuid())
  firstName    String
  lastName     String
  email        String    @unique
  phone        String?
  telegram     String?
  birthDate    DateTime?
  hireDate     DateTime? // Date when user joined company (for accrual calculations)
  positionId   String?
  gender       String?
  city         String?
  country      String?
  isAdmin      Boolean   @default(false)
  passwordHash String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  absences     Absence[]
  entitlements Entitlement?
  projects     Project[]
  workLogs     WorkLog[]
  technologies UserTechnology[]
  position     Position?        @relation(fields: [positionId], references: [id], onDelete: SetNull)

  @@map("users")
}

model Absence {
  id        String        @id @default(uuid())
  userId    String
  type      AbsenceType
  from      DateTime
  to        DateTime
  status    AbsenceStatus @default(pending)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("absences")
}

model Entitlement {
  id            String   @id @default(uuid())
  userId        String   @unique
  vacationDays  Int      @default(0)
  sickLeaveDays Int      @default(0)
  dayOffDays    Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("entitlements")
}

model Project {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users        User[]
  workLogs     WorkLog[]
  technologies ProjectTechnology[]

  @@map("projects")
}

model WorkLog {
  id        String   @id @default(uuid())
  userId    String
  date      DateTime
  start     DateTime
  end       DateTime
  projectId String?
  note      String?
  isPastDue Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)

  @@map("work_logs")
}

model Technology {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users    UserTechnology[]
  projects ProjectTechnology[]

  @@map("technologies")
}

model UserTechnology {
  id           String   @id @default(uuid())
  userId       String
  technologyId String
  createdAt    DateTime @default(now())

  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  technology Technology @relation(fields: [technologyId], references: [id], onDelete: Cascade)

  @@unique([userId, technologyId])
  @@map("user_technologies")
}

model ProjectTechnology {
  id           String   @id @default(uuid())
  projectId    String
  technologyId String
  createdAt    DateTime @default(now())

  project    Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  technology Technology @relation(fields: [technologyId], references: [id], onDelete: Cascade)

  @@unique([projectId, technologyId])
  @@map("project_technologies")
}
